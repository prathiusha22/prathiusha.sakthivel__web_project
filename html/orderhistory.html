<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>order history</title>
    <link rel="stylesheet" href="../assets/css/orderhistory.css">
</head>

<body>
    <header>
        <img class="logo" src="../assets/image/mainlogo.png" height="80px" width="250px" alt="img">

        <div class="menu-bar">
            <div class="search_box">
                <input type="text" id="search" placeholder="search">
            </div>

            <ul class="main">
                <li class="down">
                    <a class="hdg" href="../index.html">Home </a>
                </li>

                <li class="down">
                    <a class="hdg" href="../html/about.html">About</a>
                </li>

                <li>
                    <a class="hdg" href="../html/sellerpage.html">Seller</a>
                </li>

            </ul>
        </div>
    </header>

    <main>
        <!-- borderbox -->
        <h1>Purchase History</h1>

        <div class="outer_div" id="outer_div">
            <div class="get">
                <p>Your Order is Empty</p>
            </div>
            <!-- <div class="borderbox">
        
                <div class="tomato">
                    <img class="tomato1" src="../assets/image/tomato.jpg" alt="img">
                    <h2>Fresh Organic Tomato</h2>
                    <h3>Quantity:1</h3>
                    <h4>₹10 Per kg</h4>

                </div>

                <div class="price">
                    <h2 id="product">Price Details:-</h2>
                    <div class="order">
                        <p id="order">Order Price : 10</p>
                        <p id="total_count1">Total:10</p>
                    </div>
                    
                    <div class="cancel">
                      <button id="cancelbutton">Cancel Order</button>
                    </div>

                </div>

            </div>
    
            <div class="profile_box">
                <div class="profile_image">
                    <img id="user_profile" src="../assets/image/userprofileimg.jpg" alt="profile image">
                    <p id="user_name">Prathiusha Sakthivel</p>
                </div>
                <div class="details">
                    <div class="email">
                        <p>Email</p>
                        <p>prathiusha@gmail.com</p>
                    </div>
                    <div class="address">
                        <p>Address</p>
                        <p>1/243-KKR nagar,Main road,chennai.</p>
                    </div>
                    <div class="phone">
                        <p>Phone</p>
                        <p>9876543210</p>
                    </div>
                </div>

            </div> -->

        </div>
    </main>

    <script>
        const user = JSON.parse(localStorage.getItem("active_user"));
        const orderget = JSON.parse(localStorage.getItem("order")) ?? [];
        const cartget = JSON.parse(localStorage.getItem("cart"))
        console.log(cartget);

        if (orderget == null) {
            const profile_div = document.createElement("div")
            profile_div.setAttribute("class", "profile_box")
            document.querySelector(".outer_div").append(profile_div);

            const profile_image = document.createElement("div")
            profile_image.setAttribute("class", "profile_image")
            document.querySelector(".profile_box").append(profile_image)

            const profileimage = document.createElement("img")
            profileimage.setAttribute("id", "user_profile")
            profileimage.setAttribute("src", "");
            document.querySelector(".profile_image").append(profileimage);

            const username = document.createElement("p")
            username.setAttribute("id", "user_name")
            username.innerHTML = `Firstname:`
            document.querySelector(".profile_image").append(username);

            const details = document.createElement("div")
            details.setAttribute("class", "details")
            document.querySelector(".profile_box").append(details);

            const useremail = document.createElement("div")
            useremail.setAttribute("class", "email")
            document.querySelector(".details").append(useremail)

            const email_para = document.createElement("p")
            email_para.innerHTML = `Email:`
            document.querySelector(".email").append(email_para);

            const email_para2 = document.createElement("p")
            email_para2.innerHTML = item.email
            document.querySelector(".email").append(email_para2);

            const useraddress = document.createElement("div")
            useraddress.setAttribute("class", "address")
            document.querySelector(".details").append(useraddress);

            const address_para = document.createElement("p")
            address_para.innerHTML = `Address:`
            document.querySelector(".address").append(address_para);

            const address_para2 = document.createElement("p")
            address_para2.innerHTML = item.communication.address
            document.querySelector(".address").append(address_para2);

            const userphone = document.createElement("div")
            userphone.setAttribute("class", "phone")
            document.querySelector(".details").append(userphone);

            const phone_para = document.createElement("p")
            phone_para.innerHTML = "Phone Number:"
            document.querySelector(".phone").append(phone_para);

            const phone_para2 = document.createElement("p")
            phone_para2.innerHTML = item.communication.mobile_number
            document.querySelector(".phone").append(phone_para2);

        }
        else {

            orderget.find((el) => {
                // for (let i = 0; i < 1; i++) {
                if (user.email === el.email) {
                    const border_div = document.createElement("div")
                    border_div.setAttribute("class", "borderbox")
                    document.querySelector(".outer_div").append(border_div);

                    const next_div = document.createElement("div")
                    next_div.setAttribute("class", "tomato")
                    border_div.append(next_div);

                    const product_image = document.createElement("img")
                    product_image.setAttribute("class", "tomato1")
                    product_image.setAttribute("src", el.image)
                    next_div.append(product_image);

                    const h2 = document.createElement("h2")
                    h2.innerHTML = el.titlename
                    next_div.append(h2);

                    const h3 = document.createElement("h3")
                    h3.innerText = "Quantity :" + cartget[0]["quanty"]
                    next_div.append(h3);

                    const h4 = document.createElement("h4")
                    h4.innerHTML = ``
                    next_div.append(h4);

                    const productdetails_div = document.createElement("div")
                    productdetails_div.setAttribute("class", "price")
                    border_div.append(productdetails_div);

                    const heading2 = document.createElement("h2")
                    heading2.setAttribute("id", "product")
                    heading2.innerHTML = "Price Details:-"
                    productdetails_div.append(heading2);

                    const order_detail = document.createElement("div")
                    order_detail.setAttribute("class", "order")
                    productdetails_div.append(order_detail);

                    const order_para = document.createElement("p")
                    order_para.setAttribute("id", "order")
                    order_para.innerHTML = `₹${el.price} ` + `Per kg`
                    order_detail.append(order_para);

                    const total_para = document.createElement("p")
                    total_para.setAttribute("id", "total_count1")
                    total_para.innerHTML = ``
                    order_detail.append(total_para)

                    const cancel_button = document.createElement("button")
                    cancel_button.setAttribute("data-title", el.titlename)
                    cancel_button.setAttribute("id", "cancelbutton")
                    cancel_button.innerText = "Cancel Order";
                    order_detail.append(cancel_button)

                    const cancelled = document.createElement("button")
                    // Cancelled.setAttribute("class","canceledbutton")
                    cancelled.setAttribute("id", "cancelled")
                    cancelled.innerText = "Cancelled";
                    order_detail.append(cancelled)

                    console.log(el)

                    if (el.status == true) {
                        cancel_button.style.display = "block"
                        cancelled.style.display = "none"

                    }

                    if (el.status == false) {
                        cancelled.style.display = "block"
                        cancel_button.style.display = "none"
                    }





                    //     cancel_button.addEventListener("click", (e) => {
                    //         for (let j = 0; j < orderget.length; j++) {
                    //             if (user.email == el.email && el.titlename == orderget[j].titlename) {
                    //                 orderget.splice(j, 1);
                    //                 localStorage.setItem("order", JSON.stringify(orderget));
                    //                 alert("Are you sure do you want to cancel the order")
                    //                 location.reload()
                    //             }
                    //         }
                    //     })
                }
            }
            );

            // let getting=JSON.parse(localStorage.getItem("order"))
            let ordercancel = document.querySelectorAll("#cancelbutton")
            for (let i = 0; i < ordercancel.length; i++) {
                ordercancel[i].addEventListener('click', (e) => {

                    let title = ordercancel[i].dataset.title


                    orderget.find((el) => {
                        if (user.email === el.email && el.titlename == title) {

                            alert("Are you sure do you want to cancel the order")

                            if (ordercancel[i].click) {
                                console.log("worked")
                                el.status = false
                                localStorage.setItem("order", JSON.stringify(orderget))
                                location.reload(1)

                            }
                        }
                    })
                })
            }


            // let cancelled_button=document.getElementById("cancelled");
            // ordercancel.addEventListener("click" ,(e)=>{
            //   alert("Are you sure do you want to cancel the order")

            //    if(ordercancel.click){
            //     console.log("worked")
            //     el.status = false
            //     localStorage.setItem("order",JSON.stringify(orderget))
            //     location.reload(1)

            //    }

            // })

            const profile_userdetails = JSON.parse(localStorage.getItem("buyerdetails")) ?? []
            const last_user_details = JSON.parse(localStorage.getItem("user_records"));
            const last_email = localStorage.getItem("data");


            //profile//

            last_user_details.filter(item => {
                if (last_email == item.email) {

                    const profile_div = document.createElement("div")
                    profile_div.setAttribute("class", "profile_box")
                    document.querySelector(".outer_div").append(profile_div);

                    const profile_image = document.createElement("div")
                    profile_image.setAttribute("class", "profile_image")
                    document.querySelector(".profile_box").append(profile_image)

                    const profileimage = document.createElement("img")
                    profileimage.setAttribute("id", "user_profile")
                    profileimage.setAttribute("src", item.image_url);
                    document.querySelector(".profile_image").append(profileimage);

                    const username = document.createElement("p")
                    username.setAttribute("id", "user_name")
                    username.innerHTML = `${item.Firstname} ${item.lastname}`
                    document.querySelector(".profile_image").append(username);

                    const details = document.createElement("div")
                    details.setAttribute("class", "details")
                    document.querySelector(".profile_box").append(details);

                    const useremail = document.createElement("div")
                    useremail.setAttribute("class", "email")
                    document.querySelector(".details").append(useremail)

                    const email_para = document.createElement("p")
                    email_para.innerHTML = "Email"
                    document.querySelector(".email").append(email_para);

                    const email_para2 = document.createElement("p")
                    email_para2.innerHTML = item.email
                    document.querySelector(".email").append(email_para2);

                    const useraddress = document.createElement("div")
                    useraddress.setAttribute("class", "address")
                    document.querySelector(".details").append(useraddress);

                    const address_para = document.createElement("p")
                    address_para.innerHTML = "Address"
                    document.querySelector(".address").append(address_para);

                    const address_para2 = document.createElement("p")
                    address_para2.innerHTML = item.communication.address
                    document.querySelector(".address").append(address_para2);

                    const userphone = document.createElement("div")
                    userphone.setAttribute("class", "phone")
                    document.querySelector(".details").append(userphone);

                    const phone_para = document.createElement("p")
                    phone_para.innerHTML = "Phone"
                    document.querySelector(".phone").append(phone_para);

                    const phone_para2 = document.createElement("p")
                    phone_para2.innerHTML = item.communication.mobile_number
                    document.querySelector(".phone").append(phone_para2);

                }

            });

            let orderdata = JSON.parse(localStorage.getItem("order")) ?? [];
            let css = document.querySelector(".get");
            let box = document.querySelector(".borderbox")

            if (orderdata == "") {
                css.style.display = "block"
            }
            else {
                css.style.display = "none"
            }
        }







    </script>

</body>

</html>